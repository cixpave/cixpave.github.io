<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CW1</title>

    <meta name="description" content="Magmamath" />

    <meta property="og:image" content="/content/New Project (12) (1).png" />
    <meta property="og:site_name" content="Magnamath" />
    <meta property="og:locale" content="en_US" />

    <link
      rel="icon"
      type="image/x-icon"
      href="/content/New Project (12) (1).png"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link rel="stylesheet" href="/app/style.css" />
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap"
      rel="stylesheet"
    />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <meta name="apple-mobile-web-app-title" content="CW1 Assets" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <meta name="theme-color" content="#131212" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/siimple-icons/siimple-icons.css"
    />
  </head>
  <canvas id="dotCanvas"></canvas>
  <body>
    <nav class="xbox-navbar">
      <div class="navbar-left">
        <a href="/" class="home-but">
          <img src="/assets/Applet.png" alt="Home" class="home-icon" />
        </a>
      </div>

      <div class="navbar-right">
        <span class="clock" id="clock">04:55 pm</span>
      </div>
    </nav>

    <div class="upperCont"><span class="clock" id="clock">04:55 pm</span></div>

    <div class="searchCont">
      <hr />
      <div class="searchbar">
        <input class="searchbartxt" placeholder="Search" />
        <span class="nav-icon" id="search">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="16"
            height="16"
            fill="currentColor"
            class="bi bi-search"
            viewBox="0 0 16 16"
          >
            <path
              d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001q.044.06.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1 1 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0"
            />
          </svg>
        </span>
      </div>
      <hr />
    </div>

    <script>
      const delay = (ms) => new Promise((res) => setTimeout(res, ms));

      function openNav() {
        document.getElementById("mySidepanel").style.marginLeft = "5%";
        document.getElementById("overlay").style.display = "block";
      }

      function closeNav() {
        document.getElementById("mySidepanel").style.marginLeft = "-25%";
        document.getElementById("SideMenu").style.marginLeft = "-25%";
        document.getElementById("overlay").style.display = "none";
      }

      function prevNav() {
        document.getElementById("SideMenu").style.marginLeft = "-25%";
        document.getElementById("overlay").onclick = "closeNav()";
        document.getElementById("overlay").style.zIndex = "12";
        document.getElementById("overlay").onclick = function () {
          closeNav();
        };
      }

      document.getElementById("search").addEventListener("click", function () {
        document.getElementById("search-bar").style.display = "block";
      });

      function settings() {
        document.getElementById("SideMenu").style.marginLeft = "8%";
        document.getElementById("overlay").style.zIndex = "14";
        document.getElementById("overlay").onclick = function () {
          prevNav();
        };
      }

      function sets() {
        const settin = async () => {
          openNav();
          await delay(80); // Wait for 2 seconds
          settings();
        };

        settin();
      }
    </script>

    <script>
      // Function to check the number of game buttons and update accordingly
      window.addEventListener("DOMContentLoaded", function () {
        // Get the container that holds the game cards
        const container = document.querySelector(".game-container");

        // Function to handle adding/removing the library button
        function checkGameButtons() {
          // Get all game buttons inside the container
          const gameButtons = container.querySelectorAll(".game-button");

          // If there are 8 or more game buttons
          if (gameButtons.length >= 8) {
            // Remove the last game card
            const lastGameCard = container.querySelector(
              ".game-card:last-child",
            );
            if (lastGameCard) {
              lastGameCard.remove();
            }

            // Create a new game card for the "Library" button
            const libraryCard = document.createElement("div");
            libraryCard.classList.add("game-card");

            const libraryButton = document.createElement("button");
            libraryButton.classList.add("game-button");
            libraryButton.textContent = "Library";
            libraryButton.id = "library-btn";

            // Add event listener for the "Library" button to redirect
            libraryButton.addEventListener("click", function () {
              window.location.href = "/library.html"; // Redirect to the library page
            });

            libraryCard.appendChild(libraryButton);
            container.appendChild(libraryCard); // Add the new "Library" button
          }
        }

        // Call the function to check and update the game buttons
        checkGameButtons();
      });
    </script>

    <script>
      //User Settings
      function getCookie(name) {
        return document.cookie.split("; ").reduce((acc, cookie) => {
          const [k, v] = cookie.split("=");
          return k === name ? decodeURIComponent(v) : acc;
        }, null);
      }

      function setCookie(name, value, days) {
        const expires = new Date(Date.now() + days * 864e5).toUTCString();
        document.cookie =
          name +
          "=" +
          encodeURIComponent(value) +
          "; expires=" +
          expires +
          "; path=/";
      }

      const themeToggle = document.getElementById("themeToggle");
      const body = document.body; // Or another relevant parent element

      // document.getElementById('scheme-btn').addEventListener('click', function () {
      //    setCookie('theme', 'light', 30);
      //    body.classList.toggle('light-mode');
      //  });
    </script>

    <script>
      (function () {
        // Gather all potentially focusable elements
        const allFocusableSelectors = [
          ".game-button",
          ".nav-icon",
          ".side-panel a",
          ".hmbutton a", // Include the link inside the home button
        ];
        let allFocusableElements = Array.from(
          document.querySelectorAll(allFocusableSelectors.join(",")),
        );
        let focusedIndex = 3;
        let lastMoveTime = 0;
        let gamepadConnected = false;
        let sidePanelOpen = false;
        const sidePanel = document.getElementById("mySidepanel");
        const sideMenu = document.getElementById("SideMenu"); // Get the SideMenu element
        let gamepadLoopInterval; // Variable to hold the interval ID

        // Add CSS for focus highlight
        const style = document.createElement("style");
        style.textContent = `
        .focused {
          transform: translateY(-5px) scale(1.05);
          box-shadow: 0 0px 12px rgba(255, 255, 255, 0.801);
          filter: brightness(1.005);
          outline: none; /* Remove default focus outline */
          transition: transform 0.3s ease;
        }
      `;
        document.head.appendChild(style);

        function isElementVisible(el) {
          if (!el) return false;
          const rect = el.getBoundingClientRect();
          return (
            rect.top >= 0 &&
            rect.left >= 0 &&
            rect.bottom <=
              (window.innerHeight || document.documentElement.clientHeight) &&
            rect.right <=
              (window.innerWidth || document.documentElement.clientWidth) &&
            getComputedStyle(el).display !== "none" &&
            getComputedStyle(el).visibility !== "hidden"
          );
        }

        function getVisibleFocusableElements() {
          return allFocusableElements.filter((el) => {
            const inSidePanel = sidePanel && sidePanel.contains(el);
            const inSideMenu = sideMenu && sideMenu.contains(el);

            return (
              isElementVisible(el) &&
              (sidePanelOpen ? inSidePanel : !inSidePanel) &&
              (sidePanelOpen ? true : !inSideMenu)
            );
          });
        }

        let visibleFocusableElements = getVisibleFocusableElements();

        function updateVisibleElements() {
          visibleFocusableElements = getVisibleFocusableElements();
          if (focusedIndex >= visibleFocusableElements.length) {
            focusedIndex =
              visibleFocusableElements.length > 0
                ? visibleFocusableElements.length - 1
                : 0;
          }
          focusElement(focusedIndex);
        }

        function focusElement(index) {
          visibleFocusableElements.forEach((el) =>
            el.classList.remove("focused"),
          );
          if (visibleFocusableElements[index]) {
            visibleFocusableElements[index].classList.add("focused");
            visibleFocusableElements[index].scrollIntoView({
              block: "nearest",
              inline: "nearest",
            });
          }
        }

        function activateElement(index) {
          if (visibleFocusableElements[index]) {
            visibleFocusableElements[index].click();
          }
        }

        function openNav() {
          if (sidePanel) {
            sidePanel.style.width = "250px";
          }
          const overlay = document.getElementById("overlay");
          if (overlay) {
            overlay.style.display = "block";
          }
          sidePanelOpen = true;
          updateVisibleElements();
          focusedIndex = 0; // Focus on the first element in the side panel
          focusElement(focusedIndex);
        }

        function closeNav() {
          if (sidePanel) {
            sidePanel.style.width = "0";
          }
          const overlay = document.getElementById("overlay");
          if (overlay) {
            overlay.style.display = "none";
          }
          sidePanelOpen = false;
          updateVisibleElements();
          focusedIndex = 0; // Reset focus to the main content
          focusElement(focusedIndex);
        }

        // Gamepad polling loop
        function gamepadLoop() {
          const now = Date.now();
          const gamepads = navigator.getGamepads ? navigator.getGamepads() : [];
          const gp = gamepads[0];

          if (gp) {
            gamepadConnected = true;
            const threshold = 0.5;
            const stickY = gp.axes[1];
            const up = gp.buttons[12]?.pressed || stickY < -threshold;
            const down = gp.buttons[13]?.pressed || stickY > threshold;
            const left = gp.buttons[14]?.pressed || gp.axes[0] < -threshold;
            const right = gp.buttons[15]?.pressed || gp.axes[0] > threshold;
            const buttonB = gp.buttons[1]?.pressed; // 'B' button is typically index 1

            if (sidePanelOpen && buttonB) {
              closeNav();
              lastMoveTime = now;
            } else if (now - lastMoveTime > 200) {
              if (up) {
                focusedIndex =
                  (focusedIndex - 1 + visibleFocusableElements.length) %
                  visibleFocusableElements.length;
                focusElement(focusedIndex);
                lastMoveTime = now;
              } else if (down) {
                focusedIndex =
                  (focusedIndex + 1) % visibleFocusableElements.length;
                focusElement(focusedIndex);
                lastMoveTime = now;
              } else if (left) {
                focusedIndex =
                  (focusedIndex - 1 + visibleFocusableElements.length) %
                  visibleFocusableElements.length;
                focusElement(focusedIndex);
                lastMoveTime = now;
              } else if (right) {
                focusedIndex =
                  (focusedIndex + 1) % visibleFocusableElements.length;
                focusElement(focusedIndex);
                lastMoveTime = now;
              }
            }

            if (gp.buttons[0]?.pressed) {
              activateElement(focusedIndex);
              lastMoveTime = now;
            }
          } else {
            gamepadConnected = false;
            clearInterval(gamepadLoopInterval); // Stop the loop if no gamepad
            gamepadLoopInterval = null;
          }
        }

        function startGamepadLoop() {
          if (!gamepadLoopInterval) {
            gamepadLoopInterval = setInterval(gamepadLoop, 100); // Adjust interval as needed (e.g., 100ms)
          }
        }

        function stopGamepadLoop() {
          clearInterval(gamepadLoopInterval);
          gamepadLoopInterval = null;
          gamepadConnected = false;
        }

        window.addEventListener("gamepadconnected", () => {
          console.log("Gamepad connected.");
          gamepadConnected = true;
          startGamepadLoop();
        });

        window.addEventListener("gamepaddisconnected", () => {
          console.log("Gamepad disconnected.");
          stopGamepadLoop();
        });

        // Call updateVisibleElements when the window is resized (viewport might change)
        window.addEventListener("resize", updateVisibleElements);

        // Initial check for already connected gamepad
        if (navigator.getGamepads) {
          const initialGamepads = navigator.getGamepads();
          for (let i = 0; i < initialGamepads.length; i++) {
            if (initialGamepads[i]) {
              console.log("Gamepad already connected on load.");
              gamepadConnected = true;
              startGamepadLoop();
              break;
            }
          }
        }
      })();
    </script>
    <script src="/script.js"></script>
    <div class="bottompage">
      <span class="nav-icon" id="settings" onclick="sets()"
        ><svg
          xmlns="http://www.w3.org/2000/svg"
          width="16"
          height="16"
          fill="currentColor"
          class="bi bi-gear"
          viewBox="0 0 16 16"
        >
          <path
            d="M8 4.754a3.246 3.246 0 1 0 0 6.492 3.246 3.246 0 0 0 0-6.492M5.754 8a2.246 2.246 0 1 1 4.492 0 2.246 2.246 0 0 1-4.492 0"
          />
          <path
            d="M9.796 1.343c-.527-1.79-3.065-1.79-3.592 0l-.094.319a.873.873 0 0 1-1.255.52l-.292-.16c-1.64-.892-3.433.902-2.54 2.541l.159.292a.873.873 0 0 1-.52 1.255l-.319.094c-1.79.527-1.79 3.065 0 3.592l.319.094a.873.873 0 0 1 .52 1.255l-.16.292c-.892 1.64.901 3.434 2.541 2.54l.292-.159a.873.873 0 0 1 1.255.52l.094.319c.527 1.79 3.065 1.79 3.592 0l.094-.319a.873.873 0 0 1 1.255-.52l.292.16c1.64.893 3.434-.902 2.54-2.541l-.159-.292a.873.873 0 0 1 .52-1.255l.319-.094c1.79-.527 1.79-3.065 0-3.592l-.319-.094a.873.873 0 0 1-.52-1.255l.16-.292c.893-1.64-.902-3.433-2.541-2.54l-.292.159a.873.873 0 0 1-1.255-.52zm-2.633.283c.246-.835 1.428-.835 1.674 0l.094.319a1.873 1.873 0 0 0 2.693 1.115l.291-.16c.764-.415 1.6.42 1.184 1.185l-.159.292a1.873 1.873 0 0 0 1.116 2.692l.318.094c.835.246.835 1.428 0 1.674l-.319.094a1.873 1.873 0 0 0-1.115 2.693l.16.291c.415.764-.42 1.6-1.185 1.184l-.291-.159a1.873 1.873 0 0 0-2.693 1.116l-.094.318c-.246.835-1.428.835-1.674 0l-.094-.319a1.873 1.873 0 0 0-2.692-1.115l-.292.16c-.764.415-1.6-.42-1.184-1.185l.159-.291A1.873 1.873 0 0 0 1.945 8.93l-.319-.094c-.835-.246-.835-1.428 0-1.674l.319-.094A1.873 1.873 0 0 0 3.06 4.377l-.16-.292c-.415-.764.42-1.6 1.185-1.184l.292.159a1.873 1.873 0 0 0 2.692-1.115z"
          /></svg
      ></span>
    </div>

    <script>
      function updateTime() {
        const now = new Date();
        let hours = now.getHours();
        const minutes = now.getMinutes().toString().padStart(2, "0");
        const ampm = hours >= 12 ? "pm" : "am";

        hours = hours % 12;
        hours = hours ? hours : 12; // 0 becomes 12

        const timeString = `${hours}:${minutes} ${ampm}`;
        document.getElementById("clock").textContent = timeString;
      }

      updateTime();
      setInterval(updateTime, 1000);
    </script>
  </body>
</html>
